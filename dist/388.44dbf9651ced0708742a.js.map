{"version":3,"file":"388.44dbf9651ced0708742a.js","mappings":"wRAoBA,MAAMA,EAA2D,CAC7DC,YAAY,EACZC,kBAAkB,GAOP,SAASC,EAAaC,GAAqB,IAApB,UAACC,GAAiBD,EACpD,MAAME,GAAoBC,EAAAA,EAAAA,cAAaC,IAAuBC,EAAAA,EAAAA,IAAiBD,EAAOH,KAChFK,GAAoBH,EAAAA,EAAAA,cAAaC,IAAuBG,EAAAA,EAAAA,GAAwBH,EAAOH,KACvFO,GAAmBC,EAAAA,EAAAA,QAAwB,OAC1CC,EAAeC,GAAoBC,IAAAA,UAAwB,IAElEC,EAAAA,EAAAA,YAAU,KACN,IAAKL,EAAiBM,QAClB,OAGJ,MAAMC,EAA4BP,EAAiBM,QAAQE,YAAcR,EAAiBM,QAAQG,YAC5FC,EAA0BV,EAAiBM,QAAQK,aAAeX,EAAiBM,QAAQM,aAEjGT,EAAiBI,GAA6BG,EAAwB,GACvE,CAAChB,aAAiB,EAAjBA,EAAmBmB,OAEvB,MACMC,GADOC,EAAAA,EAAAA,WAC2BC,cAAc,CAACC,GAAI,4BAA6BC,eAAgB,wBAElGC,EACFf,IAAAA,cAACgB,EAAAA,EAAQ,CACLC,QAAS3B,aAAiB,EAAjBA,EAAmBmB,KAC5BS,QAASlC,IAIXmC,GAAqBC,EAAAA,EAAAA,UAAQ,KACxB,CACHC,gBAAiB/B,aAAiB,EAAjBA,EAAmBgC,oBAEzC,CAAChC,IAEEiC,GAAyBH,EAAAA,EAAAA,UAAQ,KAEnC,IAAK9B,IAAsBA,EAAkBgC,iBACzC,MAAO,CAAC,EAGZ,MAAME,GAAQC,EAAAA,EAAAA,IAA0BnC,EAAkBgC,kBAM1D,MAAO,CACHE,QACA,8BAA+BA,EAClC,GACF,CAAClC,IAEJ,OAAKA,GAAsBI,EAKvBM,IAAAA,cAAC0B,EAAAA,EAAW,CACRC,MAAOZ,EACPa,UAAU,uBACVC,YAAY,EACZC,gBAAgB,SAChBC,UAAWjC,GAEXE,IAAAA,cAAA,OACI4B,UAAU,iBACV,cAAY,2BACZI,MAAOb,GAEPnB,IAAAA,cAAA,QACI,cAAY,sBACZ4B,UAAU,sBACV,aAAYlB,EACZsB,MAAOT,EACPU,IAAKrC,GAEJmB,KAvBN,IA4Bf,CAAC5B,EAAA+C,UAAA,CAnFG7C,UAAS8C,IAAAA,OAAAC,W,2FChBN,MAAMC,EAA8B7C,IACvC,MAAM8C,GAAUC,EAAAA,EAAAA,IAAW/C,GAC3B,OAAO8C,aAAO,EAAPA,EAASE,gBAAiBC,EAAAA,GAAQC,qBAAqB,EAGrD/C,EAA0BA,CAACH,EAAoBH,KAGxD,IAFgBgD,EAA2B7C,GAGvC,OAAO,EAGX,MAAMF,GAAoBG,EAAAA,EAAAA,IAAiBD,EAAOH,GAC5CsD,GAAUC,EAAAA,EAAAA,GAAWpD,EAAOH,GAElC,OAD2BwD,QAAQF,IAAYA,EAAQG,OAASL,EAAAA,GAAQM,cAAgBJ,EAAQG,OAASL,EAAAA,GAAQO,oBACpFC,EAAAA,EAAAA,GAAqB3D,EAAkB,C,gBCrBxE4D,EAAQ,EACR,SAA8BC,GAC1B,QAAKA,IAGEN,QAAQM,EAAOC,UAAYP,QAAQM,EAAO1C,OAASoC,QAAQM,EAAO7B,kBAC7E,C","sources":["webpack://mattermost-webapp/./src/components/channel_banner/channel_banner.tsx","webpack://mattermost-webapp/./src/packages/mattermost-redux/src/selectors/entities/channel_banner.ts","webpack://mattermost-webapp/../platform/types/lib/channels.js"],"sourcesContent":["// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport React, {useEffect, useMemo, useRef} from 'react';\r\nimport {useIntl} from 'react-intl';\r\nimport {useSelector} from 'react-redux';\r\n\r\nimport {selectShowChannelBanner} from 'mattermost-redux/selectors/entities/channel_banner';\r\nimport {getChannelBanner} from 'mattermost-redux/selectors/entities/channels';\r\nimport {getContrastingSimpleColor} from 'mattermost-redux/utils/theme_utils';\r\n\r\nimport Markdown from 'components/markdown';\r\nimport WithTooltip from 'components/with_tooltip';\r\n\r\nimport type {TextFormattingOptions} from 'utils/text_formatting';\r\n\r\nimport type {GlobalState} from 'types/store';\r\n\r\nimport './style.scss';\r\n\r\nconst markdownRenderingOptions: Partial<TextFormattingOptions> = {\r\n    singleline: true,\r\n    mentionHighlight: false,\r\n};\r\n\r\ntype Props = {\r\n    channelId: string;\r\n}\r\n\r\nexport default function ChannelBanner({channelId}: Props) {\r\n    const channelBannerInfo = useSelector((state: GlobalState) => getChannelBanner(state, channelId));\r\n    const showChannelBanner = useSelector((state: GlobalState) => selectShowChannelBanner(state, channelId));\r\n    const textContainerRef = useRef<HTMLSpanElement>(null);\r\n    const [tooltipNeeded, setTooltipNeeded] = React.useState<boolean>(false);\r\n\r\n    useEffect(() => {\r\n        if (!textContainerRef.current) {\r\n            return;\r\n        }\r\n\r\n        const isOverflowingHorizontally = textContainerRef.current.offsetWidth < textContainerRef.current.scrollWidth;\r\n        const isOverflowingVertically = textContainerRef.current.offsetHeight < textContainerRef.current.scrollHeight;\r\n\r\n        setTooltipNeeded(isOverflowingHorizontally || isOverflowingVertically);\r\n    }, [channelBannerInfo?.text]);\r\n\r\n    const intl = useIntl();\r\n    const channelBannerTextAriaLabel = intl.formatMessage({id: 'channel_banner.aria_label', defaultMessage: 'Channel banner text'});\r\n\r\n    const content = (\r\n        <Markdown\r\n            message={channelBannerInfo?.text}\r\n            options={markdownRenderingOptions}\r\n        />\r\n    );\r\n\r\n    const channelBannerStyle = useMemo(() => {\r\n        return {\r\n            backgroundColor: channelBannerInfo?.background_color,\r\n        };\r\n    }, [channelBannerInfo]);\r\n\r\n    const channelBannerTextStyle = useMemo(() => {\r\n        // this is just to satisfy type checks.\r\n        if (!channelBannerInfo || !channelBannerInfo.background_color) {\r\n            return {};\r\n        }\r\n\r\n        const color = getContrastingSimpleColor(channelBannerInfo.background_color);\r\n\r\n        // The CSS variable is declared here, and is being used in the stylesheet being imported in this component.\r\n        // This is needed because if the user sets background color a share of blue similar to the default link color,\r\n        // the markdown link will become almost invisible. So, the CSS variable declared here is used\r\n        // to set the color of the text in anchor tag in the stylesheet.\r\n        return {\r\n            color,\r\n            '--channel-banner-text-color': color,\r\n        };\r\n    }, [channelBannerInfo]);\r\n\r\n    if (!channelBannerInfo || !showChannelBanner) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <WithTooltip\r\n            title={content}\r\n            className='channelBannerTooltip'\r\n            delayClose={true}\r\n            forcedPlacement='bottom'\r\n            disabled={!tooltipNeeded}\r\n        >\r\n            <div\r\n                className='channel_banner'\r\n                data-testid='channel_banner_container'\r\n                style={channelBannerStyle}\r\n            >\r\n                <span\r\n                    data-testid='channel_banner_text'\r\n                    className='channel_banner_text'\r\n                    aria-label={channelBannerTextAriaLabel}\r\n                    style={channelBannerTextStyle}\r\n                    ref={textContainerRef}\r\n                >\r\n                    {content}\r\n                </span>\r\n            </div>\r\n        </WithTooltip>\r\n    );\r\n}\r\n","// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\r\n// See LICENSE.txt for license information.\r\n\r\nimport {channelBannerEnabled} from '@mattermost/types/channels';\r\nimport type {GlobalState} from '@mattermost/types/store';\r\n\r\nimport {General} from 'mattermost-redux/constants';\r\nimport {getChannel, getChannelBanner} from 'mattermost-redux/selectors/entities/channels';\r\nimport {getLicense} from 'mattermost-redux/selectors/entities/general';\r\n\r\nexport const selectChannelBannerEnabled = (state: GlobalState): boolean => {\r\n    const license = getLicense(state);\r\n    return license?.SkuShortName === General.SKUEnterpriseAdvanced;\r\n};\r\n\r\nexport const selectShowChannelBanner = (state: GlobalState, channelId: string): boolean => {\r\n    const enabled = selectChannelBannerEnabled(state);\r\n\r\n    if (!enabled) {\r\n        return false;\r\n    }\r\n\r\n    const channelBannerInfo = getChannelBanner(state, channelId);\r\n    const channel = getChannel(state, channelId);\r\n    const isValidChannelType = Boolean(channel && (channel.type === General.OPEN_CHANNEL || channel.type === General.PRIVATE_CHANNEL));\r\n    return isValidChannelType && channelBannerEnabled(channelBannerInfo);\r\n};\r\n","\"use strict\";\n// Copyright (c) 2015-present Mattermost, Inc. All Rights Reserved.\n// See LICENSE.txt for license information.\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.channelBannerEnabled = channelBannerEnabled;\nfunction channelBannerEnabled(banner) {\n    if (!banner) {\n        return false;\n    }\n    return Boolean(banner.enabled) && Boolean(banner.text) && Boolean(banner.background_color);\n}\n"],"names":["markdownRenderingOptions","singleline","mentionHighlight","ChannelBanner","_ref","channelId","channelBannerInfo","useSelector","state","getChannelBanner","showChannelBanner","selectShowChannelBanner","textContainerRef","useRef","tooltipNeeded","setTooltipNeeded","React","useEffect","current","isOverflowingHorizontally","offsetWidth","scrollWidth","isOverflowingVertically","offsetHeight","scrollHeight","text","channelBannerTextAriaLabel","useIntl","formatMessage","id","defaultMessage","content","Markdown","message","options","channelBannerStyle","useMemo","backgroundColor","background_color","channelBannerTextStyle","color","getContrastingSimpleColor","WithTooltip","title","className","delayClose","forcedPlacement","disabled","style","ref","propTypes","_pt","isRequired","selectChannelBannerEnabled","license","getLicense","SkuShortName","General","SKUEnterpriseAdvanced","channel","getChannel","Boolean","type","OPEN_CHANNEL","PRIVATE_CHANNEL","channelBannerEnabled","exports","banner","enabled"],"sourceRoot":""}