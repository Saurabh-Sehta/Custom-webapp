"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[9949],{29064:(e,t,a)=>{a.d(t,{$9:()=>h,Js:()=>u,XH:()=>d,gV:()=>m,us:()=>b,vD:()=>p});var n=a(62688),r=a.n(n),l=a(97023),s=a.n(l),o=a(14778),i=a(18515);let c=function(e){return e.EQUALS="==",e.NOT_EQUALS="!=",e.STARTS_WITH="startsWith",e.ENDS_WITH="endsWith",e.CONTAINS="contains",e.IN="in",e}({}),u=function(e){return e.IS="is",e.IS_NOT="is not",e.STARTS_WITH="starts with",e.ENDS_WITH="ends with",e.CONTAINS="contains",e.IN="in",e}({});const d={[c.EQUALS]:u.IS,[c.NOT_EQUALS]:u.IS_NOT,[c.STARTS_WITH]:u.STARTS_WITH,[c.ENDS_WITH]:u.ENDS_WITH,[c.CONTAINS]:u.CONTAINS,[c.IN]:u.IN},m={[u.IS]:{type:"comparison",celOp:c.EQUALS},[u.IS_NOT]:{type:"comparison",celOp:c.NOT_EQUALS},[u.STARTS_WITH]:{type:"method",celOp:c.STARTS_WITH},[u.ENDS_WITH]:{type:"method",celOp:c.ENDS_WITH},[u.CONTAINS]:{type:"method",celOp:c.CONTAINS},[u.IN]:{type:"list",celOp:c.IN}};function p(e){let{onClick:t,disabled:a}=e;return s().createElement("button",{className:"btn btn-sm btn-tertiary",onClick:t,disabled:a},s().createElement("i",{className:"icon icon-lock-outline"}),s().createElement(o.FormattedMessage,{id:"admin.access_control.table_editor.test_access_rule",defaultMessage:"Test access rule"}))}function b(e){let{onClick:t,disabled:a}=e;return s().createElement("button",{className:"btn btn-sm btn-tertiary",onClick:t,disabled:a},s().createElement("i",{className:"icon icon-plus"}),s().createElement(o.FormattedMessage,{id:"admin.access_control.table_editor.add_attribute",defaultMessage:"Add attribute"}))}function h(e){let{message:t,onLearnMoreClick:a}=e;return s().createElement("div",{className:"editor__help-text"},s().createElement(i.A,{message:t,options:{mentionHighlight:!1}}),a&&s().createElement("a",{href:"#",className:"editor__learn-more",onClick:a},s().createElement(o.FormattedMessage,{id:"admin.access_control.table_editor.learnMore",defaultMessage:"Learn more about creating access expressions with examples."})))}p.propTypes={onClick:r().func.isRequired,disabled:r().bool.isRequired},b.propTypes={onClick:r().func.isRequired,disabled:r().bool.isRequired},h.propTypes={message:r().string.isRequired,onLearnMoreClick:r().func}},68611:(e,t,a)=>{a.d(t,{Ay:()=>L});var n=a(62688),r=a.n(n),l=(a(57406),a(55448),a(17046),a(12401),a(76685),a(4290),a(97023)),s=a.n(l),o=a(14778),i=a(87461),c=a(71633),u=a.n(c),d=a(85406),m=a(70669),p=a(87131);const b=["attribute"],h=e=>{const{attribute:t}=e,a=function(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;a[n]=e[n]}return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],-1===t.indexOf(a)&&{}.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}(e,b);if(t){var n;const e=null===(n=t.attrs)||void 0===n?void 0:n.value_type;if("email"===e)return s().createElement(d.EmailOutlineIcon,a);if("url"===e)return s().createElement(d.LinkVariantIcon,a);if("phone"===e)return s().createElement(d.PoundIcon,a);switch(t.type){case"select":return s().createElement(d.ChevronDownCircleOutlineIcon,a);case"multiselect":return s().createElement(d.FormatListBulletedIcon,a);default:return s().createElement(d.MenuVariantIcon,a)}}return s().createElement(d.MenuVariantIcon,a)},v=e=>{let{currentAttribute:t,availableAttributes:a,disabled:n,onChange:r,menuId:i,buttonId:c,autoOpen:b=!1,onMenuOpened:v,enableUserManagedAttributes:f}=e;const{formatMessage:g}=(0,o.useIntl)(),[_,E]=(0,l.useState)(""),C=(0,l.useRef)(!1),y=(0,l.useCallback)((e=>{E(e.target.value)}),[]),S=(0,l.useMemo)((()=>a.filter((e=>e.name.toLowerCase().includes(_.toLowerCase())))),[a,_]),M=s().useCallback((e=>{r(e),E("")}),[r]),N=(0,l.useMemo)((()=>a.find((e=>e.name===t))),[t,a]);return(0,l.useEffect)((()=>{if(b&&!C.current){const e=document.getElementById(c);null==e||e.click(),v&&v()}C.current=b}),[b,c,v]),s().createElement(m.mc,{menuButton:{id:c,class:u()("btn btn-transparent field-selector-menu-button",{disabled:n}),children:s().createElement(s().Fragment,null,s().createElement(h,{attribute:N}),t||g({id:"admin.access_control.table_editor.selector.select_attribute",defaultMessage:"Select attribute"})),dataTestId:"attributeSelectorMenuButton",disabled:n},menu:{id:i,"aria-label":"Select attribute",className:"select-attribute-mui-menu"}},s().createElement(m.i6,{key:"filter_attributes",id:"filter_attributes",type:"text",placeholder:g({id:"admin.access_control.table_editor.selector.filter_attributes",defaultMessage:"Search attributes..."}),className:"attribute-selector-search",value:_,onChange:y}),S.map((e=>{var a,n,r;const{name:l}=e,o=l.includes(" "),i=(null===(a=e.attrs)||void 0===a?void 0:a.ldap)||(null===(n=e.attrs)||void 0===n?void 0:n.saml),c="admin"===(null===(r=e.attrs)||void 0===r?void 0:r.managed),u=i||c||f,b=s().createElement(m.q7,{id:"attribute-".concat(l),key:l,role:"menuitemradio",forceCloseOnSelect:!0,"aria-checked":l===t,onClick:o?void 0:()=>M(l),labels:s().createElement("span",null,l),disabled:o||!u,leadingElement:s().createElement(h,{attribute:e,size:18}),trailingElements:s().createElement(s().Fragment,null,o&&s().createElement(d.InformationOutlineIcon,{size:18}),!u&&!i&&s().createElement(d.ShieldAlertOutlineIcon,{size:18,color:"rgba(var(--center-channel-color-rgb), 0.5)"}),i&&s().createElement(d.SyncIcon,{size:18,color:"rgba(var(--center-channel-color-rgb), 0.5)"}),l===t&&s().createElement(d.CheckIcon,null))});let v=null;return o?v=g({id:"admin.access_control.table_editor.attribute_spaces_not_supported",defaultMessage:"CEL is not compatible with variable names containing spaces"}):u?i&&(v=g({id:"admin.access_control.table_editor.attribute_synced",defaultMessage:"This attribute is synced from an external source"})):v=g({id:"admin.access_control.table_editor.not_safe_to_use",defaultMessage:"Values for this attribute are managed by users and should not be used for access control. Please link attribute to AD/LDAP for use in access policies."}),v?s().createElement(p.A,{key:l,title:v},s().createElement("div",{className:"menu-item-tooltip-wrapper"},b)):b})))};v.propTypes={currentAttribute:r().string.isRequired,availableAttributes:r().array.isRequired,disabled:r().bool.isRequired,onChange:r().func.isRequired,menuId:r().string.isRequired,buttonId:r().string.isRequired,autoOpen:r().bool,onMenuOpened:r().func,enableUserManagedAttributes:r().bool.isRequired};const f=v;var g=a(29064);const _=e=>{let{currentOperator:t,disabled:a,onChange:n}=e;const{formatMessage:r}=(0,o.useIntl)(),[i,c]=(0,l.useState)(""),p=s().useCallback((e=>{n(e.id),c("")}),[n]),b=(0,l.useMemo)((()=>C(t)),[t]),h=b.icon,v=s().useCallback((e=>{c(e.target.value)}),[]),f=(0,l.useMemo)((()=>Object.values(y).filter((e=>r(e.label).toLowerCase().includes(i.toLowerCase())))),[i,r]);return s().createElement(m.mc,{menuButton:{id:"operator-selector-button",class:u()("btn btn-transparent field-selector-menu-button",{disabled:a}),children:s().createElement(s().Fragment,null,s().createElement(h,{size:18,color:"rgba(var(--center-channel-color-rgb), 0.64)"}),s().createElement(o.FormattedMessage,b.label)),dataTestId:"operatorSelectorMenuButton",disabled:a},menu:{id:"operator-selector-menu","aria-label":"Select operator",className:"select-operator-mui-menu"}},s().createElement(m.i6,{key:"filter_operators",id:"filter_operators",type:"text",placeholder:r({id:"admin.access_control.table_editor.selector.filter_operators",defaultMessage:"Search operators..."}),className:"attribute-selector-search",value:i,onChange:v}),f.map((e=>{const{id:t,icon:a,label:n}=e;return s().createElement(m.q7,{id:t,key:t,role:"menuitemradio",forceCloseOnSelect:!0,"aria-checked":t===b.id,onClick:()=>p(e),labels:s().createElement(o.FormattedMessage,n),leadingElement:s().createElement(a,{size:18}),trailingElements:t===b.id&&s().createElement(d.CheckIcon,null)})})))};_.propTypes={currentOperator:r().string.isRequired,disabled:r().bool.isRequired,onChange:r().func.isRequired};const E=_,C=e=>{for(const t of Object.values(y))if(t.id===e)return t;return y.is},y={[g.Js.IS]:{id:g.Js.IS,icon:d.EqualIcon,label:(0,o.defineMessage)({id:"admin.access_control.table_editor.operator.is",defaultMessage:"is"})},[g.Js.IS_NOT]:{id:g.Js.IS_NOT,icon:d.NotEqualVariantIcon,label:(0,o.defineMessage)({id:"admin.access_control.table_editor.operator.is_not",defaultMessage:"is not"})},[g.Js.IN]:{id:g.Js.IN,icon:d.ElementOfIcon,label:(0,o.defineMessage)({id:"admin.access_control.table_editor.operator.in",defaultMessage:"in"})},[g.Js.STARTS_WITH]:{id:g.Js.STARTS_WITH,icon:d.FunctionIcon,label:(0,o.defineMessage)({id:"admin.access_control.table_editor.operator.starts_with",defaultMessage:"starts with"})},[g.Js.ENDS_WITH]:{id:g.Js.ENDS_WITH,icon:d.FunctionIcon,label:(0,o.defineMessage)({id:"admin.access_control.table_editor.operator.ends_with",defaultMessage:"ends with"})},[g.Js.CONTAINS]:{id:g.Js.CONTAINS,icon:d.FunctionIcon,label:(0,o.defineMessage)({id:"admin.access_control.table_editor.operator.contains",defaultMessage:"contains"})}},S=e=>{let{values:t,disabled:a,updateValues:n,options:r=[],allowCreateValue:i=!1,placeholder:c}=e;const{formatMessage:p}=(0,o.useIntl)(),[b,h]=(0,l.useState)(""),v=!(r.length>0)||i,f=(0,l.useCallback)((e=>{h(e.target.value)}),[]),g=(0,l.useMemo)((()=>r.filter((e=>(e.name||"").toLowerCase().includes(b.toLowerCase())))),[r,b]),_=p({id:"admin.access_control.table_editor.values.select_values",defaultMessage:"Select values..."}),E=p({id:"admin.access_control.table_editor.values.create_placeholder",defaultMessage:"Type to create value"}),C=(0,l.useCallback)((e=>{const a=t.includes(e)?t.filter((t=>t!==e)):[...t,e];n(a)}),[t,n]),y=(0,l.useCallback)((e=>{const a=e.trim();a&&!t.includes(a)&&(n([...t,a]),h(""))}),[t,n]),S=(0,l.useCallback)((e=>{"Tab"!==e.key&&e.stopPropagation(),"Enter"===e.key&&v&&b.trim()&&(e.preventDefault(),y(b))}),[v,b,y]),M=(0,l.useCallback)(((e,a)=>{e.stopPropagation();const r=t.filter((e=>e!==a));n(r)}),[t,n]),N=(0,l.useMemo)((()=>{if(0===t.length){let e=_;v&&0===r.length&&(e=E);const t=c||e,a=t===_||t===E;return s().createElement("span",{className:u()({"value-selector-menu-button__placeholder":a})},t)}return s().createElement("div",{className:"value-selector-menu-button__multi-values-container"},t.map((e=>s().createElement("div",{key:e,className:"select__multi-value"},s().createElement("div",{className:"select__multi-value__label"},e),!a&&s().createElement("div",{className:"select__multi-value__remove",onClick:t=>M(t,e),role:"button",tabIndex:0,onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||M(t,e)}},s().createElement(d.CloseIcon,{size:12}))))))}),[t,a]);return s().createElement("div",{className:"values-editor"},s().createElement(m.mc,{menuButton:{id:"value-selector-button",class:u()("btn btn-transparent field-selector-menu-button",{disabled:a}),children:s().createElement("span",{className:"value-selector-menu-button__inner-wrapper"},N,s().createElement(d.ChevronDownIcon,{size:18,color:"rgba(var(--center-channel-color-rgb), 0.5)"})),dataTestId:"valueSelectorMenuButton",disabled:a},menu:{id:"value-selector-menu","aria-label":c||_,className:"select-value-mui-menu"}},s().createElement(m.i6,{key:"filter_values",id:"filter_values",type:"text",placeholder:p({id:"admin.access_control.table_editor.selector.filter_or_create",defaultMessage:"Search or create value..."}),className:"attribute-selector-search",value:b,onChange:f,onKeyDown:S}),g.map((e=>{const a=e.name||"",n=e.id||a,r=t.includes(a);return s().createElement(m.q7,{id:"value-option-".concat(n),key:n,role:"menuitemcheckbox",forceCloseOnSelect:!1,"aria-checked":r,onClick:()=>C(a),labels:s().createElement("span",null,a),trailingElements:r&&s().createElement(d.CheckIcon,null)})})),v&&b.trim()&&!g.some((e=>e.name===b.trim()))&&s().createElement(m.q7,{id:"create-value-option",key:"create-value-option",onClick:()=>y(b),labels:s().createElement("span",null,p({id:"admin.access_control.table_editor.create_value",defaultMessage:'Create "{value}"'},{value:b.trim()}))})))};var M=a(78451);const N=e=>{let{value:t,disabled:a,updateValue:n,options:r=[],allowCreateValue:i=!1,placeholder:c}=e;const{formatMessage:p}=(0,o.useIntl)(),[b,h]=(0,l.useState)(""),[v,f]=(0,l.useState)(""),[g,_]=(0,l.useState)(!1),E=r.length>0,C=(0,l.useCallback)((()=>{const e=v.trim();e&&n(e),f(""),_(!1)}),[v,n]),y=(0,l.useCallback)((e=>{"Enter"===e.key&&(e.preventDefault(),C())}),[C]),S=(0,l.useCallback)((e=>{h(e.target.value)}),[]),N=(0,l.useMemo)((()=>r.filter((e=>(e.name||"").toLowerCase().includes(b.toLowerCase())))),[r,b]),T=p({id:"admin.access_control.table_editor.value.select_value",defaultMessage:"Select value"}),I=(0,l.useCallback)((e=>{n(e),h("")}),[n]),O=(0,l.useCallback)((e=>{const t=e.trim();t&&n(t),h("")}),[n]),k=(0,l.useCallback)((e=>{"Tab"!==e.key&&e.stopPropagation(),"Enter"===e.key&&i&&b.trim()&&(e.preventDefault(),O(b))}),[i,b,O]);if(!E)return s().createElement("div",{className:"values-editor"},s().createElement("input",{type:"text",className:"values-editor__simple-input",value:g?v:t,onChange:e=>f(e.target.value),onKeyDown:y,onFocus:()=>{_(!0),t&&f(t)},onBlur:C,placeholder:c||p({id:"admin.access_control.table_editor.value.placeholder",defaultMessage:"Add value..."}),disabled:a,maxLength:M.Ay.MAX_CUSTOM_ATTRIBUTE_LENGTH}));const A=t||c||T,P=A===T;return s().createElement("div",{className:"values-editor"},s().createElement(m.mc,{menuButton:{id:"value-selector-button",class:u()("btn btn-transparent field-selector-menu-button",{disabled:a}),children:s().createElement("span",{className:"value-selector-menu-button__inner-wrapper"},s().createElement("span",{className:u()({"value-selector-menu-button__placeholder":P})},A),s().createElement(d.ChevronDownIcon,{size:18,color:"rgba(var(--center-channel-color-rgb), 0.5)"})),dataTestId:"valueSelectorMenuButton",disabled:a},menu:{id:"value-selector-menu","aria-label":c||T,className:"select-value-mui-menu"}},s().createElement(m.i6,{key:"filter_values",id:"filter_values",type:"text",placeholder:p({id:"admin.access_control.table_editor.selector.filter_or_create",defaultMessage:"Search or create value..."}),className:"attribute-selector-search",value:b,onChange:S,onKeyDown:k}),N.map((e=>{const a=e.name||"",n=e.id||a,r=t===a;return s().createElement(m.q7,{id:"value-option-".concat(n),key:n,role:"menuitemradio",forceCloseOnSelect:!0,"aria-checked":r,onClick:()=>I(a),labels:s().createElement("span",null,a),trailingElements:r&&s().createElement(d.CheckIcon,null)})})),i&&b.trim()&&!N.some((e=>e.name===b.trim()))&&s().createElement(m.q7,{id:"create-value-option",key:"create-value-option",onClick:()=>O(b),labels:s().createElement("span",null,p({id:"admin.access_control.table_editor.create_value",defaultMessage:'Create "{value}"'},{value:b.trim()}))})))},T=e=>{let{row:t,disabled:a,updateValues:n,options:r=[],allowCreateValue:l=!1,placeholder:o}=e;return"in"===t.operator?s().createElement(S,{values:t.values,disabled:a,updateValues:n,options:r,allowCreateValue:l,placeholder:o}):s().createElement(N,{value:t.values[0]||"",disabled:a,updateValue:e=>n([e]),options:r,allowCreateValue:l,placeholder:o})};T.propTypes={row:r().shape({attribute:r().string.isRequired,operator:r().string.isRequired,values:r().arrayOf(r().string).isRequired,attribute_type:r().string.isRequired}).isRequired,disabled:r().bool.isRequired,updateValues:r().func.isRequired,options:r().array,allowCreateValue:r().bool,placeholder:r().string};const I=T;var O=a(62100),k=a(1643);function A(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?A(Object(a),!0).forEach((function(t){w(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):A(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function w(e,t,a){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function R(e){let{value:t,onChange:a,onValidate:n,disabled:r=!1,userAttributes:c,enableUserManagedAttributes:u,onParseError:d,channelId:m,actions:p}=e;const{formatMessage:b}=(0,o.useIntl)(),[h,v]=(0,l.useState)([]),[_,C]=(0,l.useState)(!1),[y,S]=(0,l.useState)(!1),[M,N]=(0,l.useState)(null);(0,l.useEffect)((()=>{t&&""!==t.trim()?p.getVisualAST(t).then((e=>{var t,a;if(e.error)return v([]),void(null!==(t=e.error.message)&&void 0!==t&&t.includes("403")||null!==(a=e.error.message)&&void 0!==a&&a.includes("Forbidden")||d(e.error.message));v((e=>{const t=[];if(!e)return t;for(const a of e.conditions){let e;if(!a.attribute.startsWith("user.attributes."))throw new Error("Unknown attribute: ".concat(a.attribute));e=a.attribute.slice(16);let n,r=g.XH[a.operator];r||(r=g.Js.IS),n=Array.isArray(a.value)?a.value:[a.value],t.push({attribute:e,operator:r,values:n,attribute_type:a.attribute_type})}return t})(e.data))})).catch((e=>{var t,a;v([]),n&&n(!1),null!==(t=e.message)&&void 0!==t&&t.includes("403")||null!==(a=e.message)&&void 0!==a&&a.includes("Forbidden")||d(e.message)})):v([])}),[t]);const T=(0,l.useCallback)((e=>{const t=e.filter((e=>e.attribute)),r=t.map((e=>{const t="user.attributes.".concat(e.attribute),a=g.gV[e.operator],n=c.find((t=>t.name===e.attribute));if(!a){const a=e.values.map((e=>'"'.concat(e,'"'))).join(", ");return"multiselect"===(null==n?void 0:n.type)?"[".concat(a,"] in ").concat(t):"".concat(t," in [").concat(a,"]")}if("list"===a.type){const r=e.values.map((e=>'"'.concat(e,'"'))).join(", ");return"multiselect"===(null==n?void 0:n.type)?"[".concat(r,"] ").concat(a.celOp," ").concat(t):"".concat(t," ").concat(a.celOp," [").concat(r,"]")}const r=e.values.length>0?e.values[0]:"";return"comparison"===a.type?"".concat(t," ").concat(a.celOp,' "').concat(r,'"'):"".concat(t,".").concat(a.celOp,'("').concat(r,'")')})).join(" && ");a(r),n&&n(""===r||t.length>0)}),[a,n,c]),A=(0,l.useCallback)((()=>((e,t)=>e.find((e=>{var a,n,r;const l=e.name.includes(" "),s=(null===(a=e.attrs)||void 0===a?void 0:a.ldap)||(null===(n=e.attrs)||void 0===n?void 0:n.saml),o="admin"===(null===(r=e.attrs)||void 0===r?void 0:r.managed);return!l&&(s||o||t)})))(c,u)),[c,u]),w=(0,l.useCallback)((()=>{if(0===c.length)return void d("No user attributes available. Please ensure ABAC is properly configured and you have the necessary permissions.");const e=A();e?v((t=>{var a;const n=[...t,{attribute:e.name,operator:g.Js.IS,values:[],attribute_type:(null===(a=c[0])||void 0===a?void 0:a.type)||""}];return T(n),N(n.length-1),n})):d("No available user attributes found for rule creation.")}),[c,T,A]),R=(0,l.useCallback)((e=>{v((t=>{const a=t.toSpliced(e,1);return T(a),a}))}),[T]),L=(0,l.useCallback)(((e,t)=>{v((a=>{const n=[...a],r=n[e].attribute;return n[e]=P(P({},n[e]),{},{attribute:t}),r!==t&&(n[e].values=[],n[e].operator=g.Js.IS),T(n),n}))}),[T]),q=(0,l.useCallback)(((e,t)=>{v((a=>{const n=a[e].operator;let r=[...a[e].values];t===g.Js.IN&&n!==g.Js.IN?r=r.map((e=>e.trim())).filter((e=>""!==e)):t!==g.Js.IN&&r.length>1&&(r=[r[0]]);const l=[...a];return l[e]=P(P({},a[e]),{},{operator:t,values:r}),T(l),l}))}),[T]),F=(0,l.useCallback)(((e,t)=>{v((a=>{const n=[...a];return n[e]=P(P({},n[e]),{},{values:t}),T(n),n}))}),[T]);return s().createElement("div",{className:"table-editor"},s().createElement("table",{className:"table-editor__table"},s().createElement("thead",null,s().createElement("tr",{className:"table-editor__header-row"},s().createElement("th",{className:"table-editor__column-header"},s().createElement(o.FormattedMessage,{id:"admin.access_control.table_editor.attribute",defaultMessage:"Attribute"})),s().createElement("th",{className:"table-editor__column-header"},s().createElement(o.FormattedMessage,{id:"admin.access_control.table_editor.operator",defaultMessage:"Operator"})),s().createElement("th",{className:"table-editor__column-header"},s().createElement("span",{className:"table-editor__column-header-value"},s().createElement(o.FormattedMessage,{id:"admin.access_control.table_editor.values",defaultMessage:"Values"}))),s().createElement("th",{className:"table-editor__column-header-actions"}))),s().createElement("tbody",null,0===h.length?s().createElement("tr",null,s().createElement("td",{colSpan:4,className:"table-editor__blank-state"},s().createElement("span",null,b({id:"admin.access_control.table_editor.blank_state",defaultMessage:"Select a user attribute and values to create a rule"})))):h.map(((e,t)=>{var a,n;return s().createElement("tr",{key:t,className:"table-editor__row"},s().createElement("td",{className:"table-editor__cell"},s().createElement(f,{currentAttribute:e.attribute,availableAttributes:c,disabled:r,onChange:e=>L(t,e),menuId:"attribute-selector-menu-".concat(t),buttonId:"attribute-selector-button-".concat(t),autoOpen:t===M,onMenuOpened:()=>N(null),enableUserManagedAttributes:u})),s().createElement("td",{className:"table-editor__cell"},s().createElement(E,{currentOperator:e.operator,disabled:r,onChange:e=>q(t,e)})),s().createElement("td",{className:"table-editor__cell"},s().createElement(I,{row:e,disabled:r,updateValues:e=>F(t,e),options:e.attribute&&(null===(a=c.find((t=>t.name===e.attribute)))||void 0===a||null===(n=a.attrs)||void 0===n?void 0:n.options)||[]})),s().createElement("td",{className:"table-editor__cell-actions"},s().createElement("button",{type:"button",className:"table-editor__row-remove",onClick:()=>R(t),disabled:r,"aria-label":b({id:"admin.access_control.table_editor.remove_row",defaultMessage:"Remove row"})},s().createElement("i",{className:"icon icon-trash-can-outline"}))))}))),s().createElement("tfoot",null,s().createElement("tr",null,s().createElement("td",{colSpan:4,className:"table-editor__add-button-container"},s().createElement(g.us,{onClick:w,disabled:r||0===c.length}))))),s().createElement("div",{className:"table-editor__actions-row"},s().createElement(g.$9,{message:b({id:"admin.access_control.table_editor.help_text",defaultMessage:"Each row is a single condition that must be met for a user to comply with the policy. All rules are combined with logical AND operator (`&&`)."})}),s().createElement(g.vD,{onClick:()=>C(!0),disabled:r||!t})),_&&s().createElement(k.A,{onExited:()=>C(!1),actions:{openModal:()=>{},searchUsers:(e,a,n)=>(0,i.Yz)(t,e,a,n,m)}}),y&&s().createElement(O.A,{onExited:()=>S(!1)}))}R.propTypes={value:r().string.isRequired,onChange:r().func.isRequired,onValidate:r().func,disabled:r().bool,userAttributes:r().array.isRequired,enableUserManagedAttributes:r().bool.isRequired,onParseError:r().func.isRequired,channelId:r().string,actions:r().shape({getVisualAST:r().func.isRequired}).isRequired};const L=R},62100:(e,t,a)=>{a.d(t,{A:()=>m});var n=a(62688),r=a.n(n),l=a(97023),s=a.n(l),o=a(14778),i=a(14696),c=a(17518),u=a(18515);const d=e=>{let{onExited:t,onHide:a}=e;return s().createElement(i.zW,{id:"CELHelpModal",className:"cel-help-modal--centered","aria-labelledby":"CELHelpModalLabel",onExited:t,onHide:a,modalHeaderText:s().createElement(o.FormattedMessage,{id:"admin.access_control.cel_help_modal.title",defaultMessage:"Common Expression Language (CEL)"}),modalSubheaderText:s().createElement(o.FormattedMessage,{id:"admin.access_control.cel_help_modal.subheader",defaultMessage:"With CEL you can define conditions to filter user attributes and control resource access."}),compassDesign:!0,bodyPadding:!1,modalLocation:"top"},s().createElement("div",{className:"cel-help-modal__content-container"},s().createElement("div",{className:"cel-help-modal__content"},s().createElement(u.A,{message:'### Basic Syntax\nCEL expressions evaluate to boolean values (`true`/`false`) to determine if access should be granted.\n### Common Examples\n- To match a specific program:\n&ensp;`user.attributes.Program == "Delta"`\n- To match any of multiple teams:\n&ensp;`user.attributes.Team in ["Sales", "Engineering"]`\n- To match an email domain:\n&ensp;`user.attributes.Email.endsWith("example.com")`\n- To combine conditions (for this example with `OR` operator, altertanitvely use `&&` for `AND` operation):\n&ensp;`user.attrs.Program == "Alpha" || user.attrs.Team == "Operations"`\n### Supported Operators and functions\n- `==`, `!=`, `&&`, `||`, `in`, `contains()`, `startsWith()`, `endsWith()`'})),s().createElement("div",{className:"cel-help-additional-info-modal__content"},s().createElement("div",{className:"cel-help-additional-info-modal__header"},s().createElement("i",{className:"icon icon-information-outline"}),s().createElement("span",{className:"cel-help-additional-info-modal__title"},s().createElement(o.FormattedMessage,{id:"admin.access_control.cel_help_modal.important_notes_title",defaultMessage:"Important Notes"}))),s().createElement("div",{className:"cel-help-additional-info-modal__text"},s().createElement(u.A,{message:"- Operators like `<` or `>` are forbidden due to incorrect string comparison.\n- Only `user.attributes` are supported; any other variables are not supported yet."}),s().createElement(o.FormattedMessage,{id:"admin.access_control.cel_help_modal.external_link",defaultMessage:"For more information, visit <link>CEL Documentation</link>.",values:{link:e=>s().createElement(c.A,{href:"https://cel.dev/",location:"cel_help_modal"},e)}})))))};d.propTypes={onExited:r().func.isRequired,onHide:r().func};const m=d},1643:(e,t,a)=>{a.d(t,{A:()=>m});var n=a(62688),r=a.n(n),l=(a(17046),a(43813),a(97023)),s=a.n(l),o=a(83675),i=a(14778),c=a(23453),u=a(24876);function d(e){let{onExited:t,actions:a}=e;const n=(0,c.useDispatch)(),[r,d]=(0,l.useState)(""),[m,p]=(0,l.useState)([]),[b,h]=(0,l.useState)(0),[v,f]=(0,l.useState)(!0),[g,_]=(0,l.useState)([]),E=(0,l.useCallback)((async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];f(!0);const l=await n(a.searchUsers(e,t,50));if(null!=l&&l.data){const e=l.data.users;p(r?e:t=>[...t,...e]),h(l.data.total)}else p([]),h(0);f(!1)}),[n,a]);return(0,l.useEffect)((()=>{E(r,"")}),[]),s().createElement(o.Modal,{dialogClassName:"a11y__modal more-modal TestResultsModal",show:!0,onHide:t,role:"none","aria-labelledby":"testResultsModalLabel",id:"testResultsModal"},s().createElement(o.Modal.Header,{closeButton:!0,style:{display:"flex",alignItems:"center"}},s().createElement(o.Modal.Title,{componentClass:"h1",id:"testResultsModalLabel"},s().createElement(i.FormattedMessage,{id:"admin.access_control.testResults",defaultMessage:"Access Rule Test Results"}))),s().createElement(o.Modal.Body,null,s().createElement(u.A,{users:m,usersPerPage:10,total:b,nextPage:e=>{if(v||!m.length)return;if(10*e<50)return;const t=m[m.length-1].id;_([...g,t]),E(r,t)},search:e=>{_([]),d(e),E(e,"",!0)},actionUserProps:{}})))}d.propTypes={onExited:r().func.isRequired,actions:r().shape({searchUsers:r().func.isRequired,openModal:r().func}).isRequired};const m=d},45495:(e,t,a)=>{a.d(t,{A:()=>d});var n=a(62688),r=a.n(n),l=(a(29206),a(97023)),s=a.n(l),o=a(14778),i=a(17461);const c=e=>{let t,a,n,r,{show:l,onConfirm:c,onCancel:d,displayName:m,toPublic:p}=e;p?(t=u.toPublicTitle,a=u.toPublicMessage,n=u.toPublicConfirm,r=u.toPublicMessageConfirmation):(t=u.toPrivateTitle,a=u.toPrivateMessage,n=u.toPrivateConfirm,r=u.toPrivateMessageConfirmation);const b=s().createElement(o.FormattedMessage,Object.assign({},t,{values:{displayName:m}})),h=s().createElement(s().Fragment,null,s().createElement("p",null,s().createElement(o.FormattedMessage,Object.assign({},a,{values:{displayName:s().createElement("strong",null,m)}}))),s().createElement("p",null,s().createElement(o.FormattedMessage,Object.assign({},r,{values:{displayName:s().createElement("strong",null,m)}})))),v=s().createElement(o.FormattedMessage,n),f=s().createElement(o.FormattedMessage,{id:"admin.team_channel_settings.convertConfirmModal.cancel",defaultMessage:"No, cancel"});return s().createElement(i.A,{show:l,title:b,message:h,modalClass:"discard-changes-modal",confirmButtonClass:"btn btn-primary",confirmButtonText:v,cancelButtonText:f,onConfirm:c,onCancel:d})};c.propTypes={show:r().bool.isRequired,onConfirm:r().func.isRequired,onCancel:r().func.isRequired,displayName:r().string.isRequired,toPublic:r().bool.isRequired};const u=(0,o.defineMessages)({toPrivateConfirm:{id:"admin.team_channel_settings.convertConfirmModal.toPrivateConfirm",defaultMessage:"Yes, convert to private channel"},toPrivateMessage:{id:"admin.team_channel_settings.convertConfirmModal.toPrivateMessageFirstLine",defaultMessage:"When you convert {displayName} to a private channel, history and membership are preserved. Publicly shared files remain accessible to anyone with the link. Membership in a private channel is by invitation only."},toPrivateMessageConfirmation:{id:"admin.team_channel_settings.convertConfirmModal.toPrivateMessageSecondLine",defaultMessage:"Are you sure you want to convert {displayName} to a private channel?"},toPrivateTitle:{id:"admin.team_channel_settings.convertConfirmModal.toPrivateTitle",defaultMessage:"Convert {displayName} to a private channel?"},toPublicConfirm:{id:"admin.team_channel_settings.convertConfirmModal.toPublicConfirm",defaultMessage:"Yes, convert to public channel"},toPublicMessage:{id:"admin.team_channel_settings.convertConfirmModal.toPublicMessageFirstLine",defaultMessage:"When you convert {displayName} to a public channel, history and membership are preserved. Public channels are discoverable and can be joined by users on the system without invitation."},toPublicMessageConfirmation:{id:"admin.team_channel_settings.convertConfirmModal.toPublicMessageSecondLine",defaultMessage:"Are you sure you want to convert {displayName} to a public channel?"},toPublicTitle:{id:"admin.team_channel_settings.convertConfirmModal.toPublicTitle",defaultMessage:"Convert {displayName} to a public channel?"}}),d=c},61295:(e,t,a)=>{a.d(t,{A:()=>u});var n=a(62688),r=a.n(n),l=(a(4290),a(97023)),s=a.n(l),o=a(72754),i=a(11038);function c(e,t,a){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class u extends s().PureComponent{constructor(e){super(e),c(this,"checkClick",(e=>{this.colorPicker.current&&this.colorPicker.current.contains(e.target)||this.setState({isOpened:!1})})),c(this,"togglePicker",(()=>{!this.state.isOpened&&this.colorInput.current&&this.colorInput.current.focus(),this.setState({isOpened:!this.state.isOpened})})),c(this,"handleColorChange",(e=>{this.setState({focused:!1}),this.props.onChange(e.hex)})),c(this,"onChange",(e=>{const t=e.target.value,a=(0,i.A)(t),n="#"+a.toHex();a.isValid()&&this.props.onChange(n),this.setState({value:t})})),c(this,"onFocus",(e=>{this.setState({focused:!0}),e.target&&e.target.setSelectionRange(1,e.target.value.length)})),c(this,"onBlur",(()=>{const e=this.state.value,t=(0,i.A)(e),a="#"+t.toHex();t.isValid()?(this.props.onChange(a),this.setState({value:a})):this.setState({value:this.props.value}),this.setState({focused:!1})})),c(this,"onKeyDown",(e=>{"Enter"!==e.key&&" "!==e.key||this.togglePicker()})),this.colorPicker=s().createRef(),this.colorInput=s().createRef(),this.state={focused:!1,isOpened:!1,value:e.value}}static getDerivedStateFromProps(e,t){return t.focused||e.value===t.value?null:{value:e.value}}componentDidUpdate(e,t){const{isOpened:a}=t,{isOpened:n}=this.state;n!==a&&(n?document.addEventListener("click",this.checkClick,{capture:!0}):document.removeEventListener("click",this.checkClick))}render(){const{id:e}=this.props,{isOpened:t,value:a}=this.state;return s().createElement("div",{className:"color-input input-group"},s().createElement("input",{id:"".concat(e,"-inputColorValue"),ref:this.colorInput,className:"form-control",type:"text",value:a,onChange:this.onChange,onBlur:this.onBlur,onFocus:this.onFocus,onKeyDown:this.onKeyDown,maxLength:7,disabled:this.props.isDisabled,"data-testid":"color-inputColorValue"}),!this.props.isDisabled&&s().createElement("span",{id:"".concat(e,"-squareColorIcon"),className:"input-group-addon color-pad",onClick:this.togglePicker},s().createElement("i",{id:"".concat(e,"-squareColorIconValue"),className:"color-icon",style:{backgroundColor:a}})),t&&s().createElement("div",{ref:this.colorPicker,className:"color-popover",id:"".concat(e,"-ChromePickerModal")},s().createElement(o.xk,{color:a,onChange:this.handleColorChange,disableAlpha:!0})))}}c(u,"propTypes",{id:r().string.isRequired,onChange:r().func.isRequired,value:r().string.isRequired,isDisabled:r().bool})},53779:(e,t,a)=>{a.d(t,{V:()=>i});var n=a(97023),r=a(23453),l=a(87461),s=a(30413),o=a(81149);const i=e=>{const t=(0,r.useDispatch)();return(0,n.useMemo)((()=>({getAccessControlFields:(a,n)=>t((0,l.R5)(a,n,e)),getVisualAST:a=>t((0,l.ps)(a,e)),searchUsers:(a,n,r,s)=>t((0,l.Yz)(a,n,r,s,e)),getChannelPolicy:e=>t((0,l.Ar)(e)),saveChannelPolicy:e=>t((0,l.IS)(e)),deleteChannelPolicy:e=>t((0,l.fQ)(e)),getChannelMembers:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;return t((0,s.p6)(e,a,n))},createJob:e=>t((0,o._S)(e)),updateAccessControlPolicyActive:(e,a)=>t((0,l.lJ)(e,a)),validateExpressionAgainstRequester:a=>t((0,l.Q6)(a,e)),createAccessControlSyncJob:e=>t((0,l.G$)(e))})),[t,e])}},87461:(e,t,a)=>{a.d(t,{Ar:()=>o,G$:()=>_,GF:()=>m,IS:()=>i,Q6:()=>g,R5:()=>b,U8:()=>d,Yz:()=>v,a5:()=>u,fQ:()=>c,kj:()=>p,lJ:()=>h,ps:()=>f}),a(43813);var n=a(77798),r=a(23877),l=a(40693),s=a(87988);function o(e,t){return(0,s.n4)({clientFunc:l.mT.getAccessControlPolicy,onSuccess:[r.JU.RECEIVED_ACCESS_CONTROL_POLICY],params:[e,t]})}function i(e){return async(t,a)=>{let n;try{n=await l.mT.updateOrCreateAccessControlPolicy(e)}catch(e){return(0,s.UP)(e,t,a),{error:e}}return t({type:r.JU.CREATE_ACCESS_CONTROL_POLICY_SUCCESS,data:n}),{data:n}}}function c(e){return(0,s.n4)({clientFunc:l.mT.deleteAccessControlPolicy,onSuccess:[r.JU.DELETE_ACCESS_CONTROL_POLICY_SUCCESS],params:[e]})}function u(e,t,a,n){return async(o,i)=>{let c;try{c=await l.mT.searchAccessControlPolicies(e,t,a,n)}catch(e){return(0,s.UP)(e,o,i),{error:e}}return o({type:r.JU.RECEIVED_ACCESS_CONTROL_POLICIES_SEARCH,data:c.policies}),{data:c}}}function d(e,t,a){return async(o,i)=>{let c;try{c=await l.mT.searchChildAccessControlPolicyChannels(e,t,a)}catch(e){return(0,s.UP)(e,o,i),{error:e}}const u={};return u[e]=c.channels.map((e=>e.id)),o((0,n.OJ)([{type:r.JU.RECEIVED_ACCESS_CONTROL_CHILD_POLICIES,data:u},{type:r.rb.RECEIVED_CHANNELS,data:c.channels}])),{data:c}}}function m(e,t){return(0,s.n4)({clientFunc:l.mT.assignChannelsToAccessControlPolicy,onSuccess:[r.JU.ASSIGN_CHANNELS_TO_ACCESS_CONTROL_POLICY_SUCCESS],params:[e,t]})}function p(e,t){return(0,s.n4)({clientFunc:l.mT.unassignChannelsFromAccessControlPolicy,onSuccess:[r.JU.UNASSIGN_CHANNELS_FROM_ACCESS_CONTROL_POLICY_SUCCESS],params:[e,t]})}function b(e,t,a){return(0,s.n4)({clientFunc:l.mT.getAccessControlFields,params:[e,t,a]})}function h(e,t){return(0,s.n4)({clientFunc:l.mT.updateAccessControlPolicyActive,params:[e,t]})}function v(e,t,a,n,o){return async(i,c)=>{let u;try{u=await l.mT.testAccessControlExpression(e,t,a,n,o)}catch(e){return(0,s.UP)(e,i,c),{error:e}}return i({type:r.zO.RECEIVED_PROFILES,data:u.users}),{data:u}}}function f(e,t){return(0,s.n4)({clientFunc:l.mT.expressionToVisualFormat,params:[e,t]})}function g(e,t){return async(a,n)=>{let r;try{r=await l.mT.validateExpressionAgainstRequester(e,t)}catch(e){return(0,s.UP)(e,a,n),{error:e}}return{data:r}}}function _(e){return async(t,a)=>{let n;try{n=await l.mT.createAccessControlSyncJob(e)}catch(e){return(0,s.UP)(e,t,a),{error:e}}return{data:n}}}}}]);
//# sourceMappingURL=9949.426cc3f8bd4dc6f48c91.js.map