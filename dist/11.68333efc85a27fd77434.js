"use strict";(self.webpackChunkmattermost_webapp=self.webpackChunkmattermost_webapp||[]).push([[11],{92600:(e,t,i)=>{i.d(t,{A:()=>p});var n=i(23453),l=i(26614),a=i(68124),s=i(62688),o=i.n(s),r=i(97023),c=i.n(r),m=i(14778),d=i(85873);const f=e=>{let{fileInfo:t,fileUrl:i,canDownloadFiles:n}=e;const l=(0,m.useIntl)(),a=[];""!==t.extension&&a.push(l.formatMessage({id:"file_info_preview.type",defaultMessage:"File type "})+t.extension.toUpperCase()),t.size&&a.push(l.formatMessage({id:"file_info_preview.size",defaultMessage:"Size "})+d.O1(t.size));const s=a.join(", ");let o=null;return o=n?c().createElement("a",{className:"file-details__preview",href:i},c().createElement("span",{className:"file-details__preview-helper"}),c().createElement("img",{alt:"file preview",src:d.Xm(t)})):c().createElement("span",{className:"file-details__preview"},c().createElement("span",{className:"file-details__preview-helper"}),c().createElement("img",{alt:"file preview",src:d.Xm(t)})),c().createElement("div",{className:"file-details__container"},o,c().createElement("div",{className:"file-details"},c().createElement("div",{className:"file-details__name"},t.name),c().createElement("div",{className:"file-details__info"},s)))};f.propTypes={fileUrl:o().string.isRequired,canDownloadFiles:o().bool.isRequired};const u=c().memo(f),p=(0,n.connect)((function(e){const t=(0,l.zj)(e);return{canDownloadFiles:(0,a.En)(t)}}))(u)},90011:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ue});var n=i(62688),l=i.n(n),a=(i(43813),i(17046),i(4290),i(71633)),s=i.n(a),o=i(97023),r=i.n(o),c=i(83675),m=i(14778),d=i(31655),f=i(85406);function u(e){const t=(0,m.useIntl)().formatMessage({id:"workspace_limits.archived_file.archived",defaultMessage:"This file is archived"}),i=r().createElement("span",{className:"file-details__preview file-details__preview--archived"},r().createElement(f.ArchiveOutlineIcon,{size:80,color:"rgba(var(--center-channel-color-rgb), 0.48)","data-testid":"archived-file-icon"}));return r().createElement("div",{className:"file-details__container"},i,r().createElement("div",{className:"file-details"},r().createElement("div",{className:"file-details__name"},e.fileInfo.name),r().createElement("div",{className:"file-details__info"},t)))}var p=i(23453),h=i(7380),v=i(92600),g=i(78451);function E(e,t,i){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class b extends r().PureComponent{constructor(e){super(e),E(this,"sourceRef",r().createRef()),E(this,"videoRef",r().createRef()),E(this,"handleFileInfoChanged",(()=>{let e=this.videoRef.current;e||(e=document.createElement("video")),this.setState({canPlay:!0})})),E(this,"handleLoadError",(()=>{this.setState({canPlay:!1})})),E(this,"stop",(()=>{if(this.videoRef.current){const e=this.videoRef.current;e.pause(),e.currentTime=0}})),this.state={canPlay:!0}}componentDidMount(){this.handleFileInfoChanged(),this.sourceRef.current&&this.sourceRef.current.addEventListener("error",this.handleLoadError,{once:!0})}componentDidUpdate(e){this.props.fileUrl!==e.fileUrl&&this.handleFileInfoChanged(),this.sourceRef.current&&this.sourceRef.current.addEventListener("error",this.handleLoadError,{once:!0})}render(){if(!this.state.canPlay)return r().createElement(v.A,{fileInfo:this.props.fileInfo,fileUrl:this.props.fileUrl});let e=g.Ay.WEB_VIDEO_WIDTH,t=g.Ay.WEB_VIDEO_HEIGHT;return this.props.isMobileView&&(e=g.Ay.MOBILE_VIDEO_WIDTH,t=g.Ay.MOBILE_VIDEO_HEIGHT),r().createElement("video",{key:this.props.fileInfo.id,ref:this.videoRef,"data-setup":"{}",controls:!0,width:e,height:t},r().createElement("source",{ref:this.sourceRef,src:this.props.fileUrl}))}}E(b,"propTypes",{fileUrl:l().string.isRequired,isMobileView:l().bool.isRequired});const w=(0,p.connect)((function(e){return{isMobileView:(0,h.w3)(e)}}))(b);var _=i(53654),I=i(75842);function y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function C(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?y(Object(i),!0).forEach((function(t){P(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function P(e,t,i){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const N=e=>{let{fileInfo:t,fileUrl:i,getContent:n}=e;const[l,a]=(0,o.useState)({code:"",lang:"",highlighted:""}),[s,c]=(0,o.useState)("success"),[m,d]=(0,o.useState)();(0,o.useEffect)((()=>{if(i!==m){const e=I.od(t.extension);!e||t.size>g.Ay.CODE_PREVIEW_MAX_FILE_SIZE?(a((e=>C(C({},e),{},{code:"",lang:""}))),c("fail")):(a((t=>C(C({},t),{},{code:"",lang:e}))),c("loading")),d(i)}}),[t.extension,t.size,i,m]);const f=!l.lang||t.size>g.Ay.CODE_PREVIEW_MAX_FILE_SIZE;if((0,o.useEffect)((()=>{i!==m&&(async()=>{if(!f)try{const e=await fetch(i);(async e=>{let t=e;const i=e;"#document"===i.nodeName&&(t=(new XMLSerializer).serializeToString(i)),null==n||n(t),a(C(C({},l),{},{code:t,highlighted:await I.Zt(l.lang,t)})),c("success")})(await e.text())}catch(e){c("fail")}})()}),[l,i,m,n,f]),"loading"===s)return r().createElement("div",{className:"view-image__loading"},r().createElement(_.A,null));if("fail"===s)return r().createElement(v.A,{fileInfo:t,fileUrl:i});const u=I.OT(l.lang);return r().createElement("div",{className:"post-code code-preview"},r().createElement("span",{className:"post-code__language"},"".concat(t.name," - ").concat(u)),r().createElement("div",{className:"hljs"},r().createElement("div",{className:"post-code__line-numbers"},I.bg(l.code)),r().createElement("code",{dangerouslySetInnerHTML:{__html:l.highlighted}})))};N.propTypes={fileUrl:l().string.isRequired,className:l().string.isRequired,getContent:l().func};const M=r().memo(N);var R=i(7596),O=i(19513),x=i(85873),L=(i(29206),i(65952)),F=i(7430),k=i(18309);const S=(0,F.ml)(),A=e=>{const t=(0,p.useSelector)((t=>{var i,n;return(0,F.wz)(t,null!==(i=null===(n=e.post)||void 0===n?void 0:n.user_id)&&void 0!==i?i:"")})),i=(0,p.useSelector)((t=>{var i,n;return(0,L.s9)()(t,null!==(i=null===(n=e.post)||void 0===n?void 0:n.channel_id)&&void 0!==i?i:"")})),n=(0,p.useSelector)((t=>{var i,n;return S(t,null!==(i=null===(n=e.post)||void 0===n?void 0:n.user_id)&&void 0!==i?i:"",!0)}));let l;const a=i?r().createElement(m.FormattedMessage,{id:"file_preview_modal_info.shared_in",defaultMessage:"Shared in ~{name}",values:{name:i.display_name||i.name}}):null;return l=e.showFileName?r().createElement(r().Fragment,null,r().createElement("h5",{className:"file-preview-modal__file-name"},e.filename),r().createElement("span",{className:"file-preview-modal__file-details"},r().createElement("span",{className:"file-preview-modal__file-details-user-name"},n),r().createElement("span",{className:"file-preview-modal__channel"},a))):r().createElement(r().Fragment,null,r().createElement("h5",{className:"file-preview-modal__user-name"},n),r().createElement("span",{className:"file-preview-modal__channel"},a)),r().createElement("div",{className:"file-preview-modal__info"},e.post&&Object.keys(e.post).length>0&&r().createElement(k.A,{size:"lg",username:null==t?void 0:t.username,url:(0,x.RG)(e.post.user_id,null==t?void 0:t.last_picture_update),className:"file-preview-modal__avatar",alt:""}),r().createElement("div",{className:"file-preview-modal__info-details"},l))};A.propTypes={showFileName:l().bool.isRequired,filename:l().string.isRequired};const D=(0,o.memo)(A);var j=i(87236),q=i(69813),T=i(35301),Z=i(17518),U=i(87131);function z(e){return Boolean(e.id)}function V(e){return Boolean(e.link)&&!z(e)}const B=e=>{const t=(0,m.useIntl)(),i=(0,p.useSelector)((e=>{var t;return null===(t=(0,q.EL)(e))||void 0===t?void 0:t.link})),n=(0,p.useDispatch)(),[l,a]=(0,o.useState)(!1);(0,o.useEffect)((()=>{z(e.fileInfo)&&e.enablePublicLink&&n((0,j.EL)(e.fileInfo.id))}),[e.fileInfo,e.enablePublicLink]),(0,o.useEffect)((()=>{l&&setTimeout((()=>{a(!1)}),2e3)}),[l]);const s=t.formatMessage({id:"full_screen_modal.close",defaultMessage:"Close"}),c=r().createElement(U.A,{title:s,key:"publicLink"},r().createElement("button",{className:"file-preview-modal-main-actions__action-item",onClick:e.handleModalClose,"aria-label":s},r().createElement("i",{className:"icon icon-close"})));let d;d=l?t.formatMessage({id:"file_preview_modal_main_actions.public_link-copied",defaultMessage:"Public link copied"}):t.formatMessage({id:"view_image_popover.publicLink",defaultMessage:"Get a public link"});const f=r().createElement(U.A,{key:"filePreviewPublicLink",title:d},r().createElement("a",{href:"#",className:"file-preview-modal-main-actions__action-item",onClick:()=>{(0,x.lW)(null!=i?i:""),a(!0)},"aria-label":d},r().createElement("i",{className:"icon icon-link-variant"}))),u=t.formatMessage({id:"view_image_popover.download",defaultMessage:"Download"}),h=r().createElement(U.A,{key:"download",title:u},r().createElement(Z.A,{href:e.fileURL,className:"file-preview-modal-main-actions__action-item",location:"file_preview_modal_main_actions",download:e.filename,"aria-label":u},r().createElement("i",{className:"icon icon-download-outline"}))),v=r().createElement(T.A,{className:"file-preview-modal-main-actions__action-item",isForText:(0,x.ti)(e.fileInfo.extension)===g.a0.TEXT,content:e.content});return r().createElement("div",{className:"file-preview-modal-main-actions__actions"},!e.showOnlyClose&&e.canCopyContent&&v,!e.showOnlyClose&&e.enablePublicLink&&e.showPublicLink&&f,!e.showOnlyClose&&e.canDownloadFiles&&h,e.showClose&&c)};B.propTypes={showOnlyClose:l().bool,showClose:l().bool,showPublicLink:l().bool,filename:l().string.isRequired,fileURL:l().string.isRequired,enablePublicLink:l().bool.isRequired,canDownloadFiles:l().bool.isRequired,canCopyContent:l().bool.isRequired,handleModalClose:l().func.isRequired,content:l().string.isRequired},B.defaultProps={showOnlyClose:!1,showClose:!0,showPublicLink:!0};const H=(0,o.memo)(B),G=["post"],W=e=>{let{post:t}=e,i=function(e,t){if(null==e)return{};var i,n,l=function(e,t){if(null==e)return{};var i={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;i[n]=e[n]}return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)i=a[n],-1===t.indexOf(i)&&{}.propertyIsEnumerable.call(e,i)&&(l[i]=e[i])}return l}(e,G);return r().createElement("div",{className:"file-preview-modal-footer"},r().createElement(D,{showFileName:!1,post:t,filename:i.filename}),r().createElement(H,Object.assign({},i,{showClose:!1,showOnlyClose:!1})))};W.propTypes={filename:l().string.isRequired,fileURL:l().string.isRequired,showPublicLink:l().bool,enablePublicLink:l().bool.isRequired,canDownloadFiles:l().bool.isRequired,isExternalFile:l().bool.isRequired,handleModalClose:l().func.isRequired,canCopyContent:l().bool.isRequired,content:l().string.isRequired};const X=(0,o.memo)(W),K=e=>{const{formatMessage:t}=(0,m.useIntl)(),i=r().createElement(U.A,{key:"previewArrowLeft",title:r().createElement(m.FormattedMessage,{id:"generic.close",defaultMessage:"Close"})},r().createElement("button",{id:"previewArrowLeft",className:"file_preview_modal_main_nav__prev",onClick:e.handlePrev,"aria-label":t({id:"file_preview_modal_main_nav.prevAriaLabel",defaultMessage:"Previous file"})},r().createElement("i",{className:"icon icon-chevron-left"}))),n=r().createElement(U.A,{key:"publicLink",title:r().createElement(m.FormattedMessage,{id:"generic.next",defaultMessage:"Next"})},r().createElement("button",{id:"previewArrowRight",className:"file_preview_modal_main_nav__next",onClick:e.handleNext,"aria-label":t({id:"file_preview_modal_main_nav.nextAriaLabel",defaultMessage:"Next file"})},r().createElement("i",{className:"icon icon-chevron-right"})));return r().createElement("div",{className:"file_preview_modal_main_nav"},i,r().createElement("span",{className:"modal-bar-file-count","aria-live":"polite","aria-atomic":"true"},r().createElement(m.FormattedMessage,{id:"file_preview_modal_main_nav.file",defaultMessage:"{count, number} of {total, number}",values:{count:e.fileIndex+1,total:e.totalFiles}})),n)};K.propTypes={fileIndex:l().number.isRequired,totalFiles:l().number.isRequired,handlePrev:l().func.isRequired,handleNext:l().func.isRequired};const J=(0,o.memo)(K),Q=["post","totalFiles","fileIndex"],Y=e=>{let{post:t,totalFiles:i,fileIndex:n}=e,l=function(e,t){if(null==e)return{};var i,n,l=function(e,t){if(null==e)return{};var i={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;i[n]=e[n]}return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)i=a[n],-1===t.indexOf(i)&&{}.propertyIsEnumerable.call(e,i)&&(l[i]=e[i])}return l}(e,Q),a=r().createElement("div",null);i>1&&(a=r().createElement(J,{totalFiles:i,fileIndex:n,handlePrev:l.handlePrev,handleNext:l.handleNext}));const s=r().createElement(H,Object.assign({},l,{showOnlyClose:l.isMobileView}));return r().createElement("div",{className:"file-preview-modal-header"},l.isMobileView&&s,!l.isMobileView&&r().createElement(D,{showFileName:!0,post:t,filename:l.filename}),a,!l.isMobileView&&s)};Y.propTypes={isMobileView:l().bool.isRequired,fileIndex:l().number.isRequired,totalFiles:l().number.isRequired,filename:l().string.isRequired,fileURL:l().string.isRequired,showPublicLink:l().bool,enablePublicLink:l().bool.isRequired,canDownloadFiles:l().bool.isRequired,canCopyContent:l().bool.isRequired,isExternalFile:l().bool.isRequired,handlePrev:l().func.isRequired,handleNext:l().func.isRequired,handleModalClose:l().func.isRequired,content:l().string.isRequired};const $=(0,o.memo)(Y);function ee(e){let t,i,n,{fileInfo:l,canDownloadFiles:a}=e;return l.id?(t=(0,d.S1)(l.id),i=l.has_preview_image?(0,d.cV)(l.id):t):(t=l.link,i=l.link),a?((0,x.ti)(l.extension)===g.a0.SVG&&(n={width:l.width,height:"auto"}),r().createElement("a",{className:"image_preview",href:"#"},r().createElement("img",{className:"image_preview__image",loading:"lazy","data-testid":"imagePreview",alt:"preview url image",src:i,style:n}))):r().createElement("img",{src:i})}ee.propTypes={canDownloadFiles:l().bool.isRequired};var te,ie,ne,le=i(46177),ae=i.n(le);class se extends r().PureComponent{render(){const e=[];let t=null;if(this.props.showZoomControls){let i,n,l;n=this.props.scale&&this.props.scale>g.tR.MIN_SCALE?r().createElement("span",{className:"modal-zoom-btn"},r().createElement("a",{onClick:this.props.handleZoomOut&&ae()(this.props.handleZoomOut,300,{maxWait:300})},r().createElement("i",{className:"icon icon-minus"}))):r().createElement("span",{className:"btn-inactive"},r().createElement("i",{className:"icon icon-minus"})),e.push(r().createElement(U.A,{key:"zoomOut",title:r().createElement(m.FormattedMessage,{id:"view_image.zoom_out",defaultMessage:"Zoom Out"})},n)),i=this.props.scale&&this.props.scale>g.tR.DEFAULT_SCALE?r().createElement("span",{className:"modal-zoom-btn"},r().createElement("a",{onClick:this.props.handleZoomReset},r().createElement("i",{className:"icon icon-magnify-minus"}))):this.props.scale&&this.props.scale<g.tR.DEFAULT_SCALE?r().createElement("span",{className:"modal-zoom-btn"},r().createElement("a",{onClick:this.props.handleZoomReset},r().createElement("i",{className:"icon icon-magnify-plus"}))):r().createElement("span",{className:"btn-inactive"},r().createElement("i",{className:"icon icon-magnify-minus"})),e.push(r().createElement(U.A,{key:"zoomReset",title:r().createElement(m.FormattedMessage,{id:"view_image.zoom_reset",defaultMessage:"Reset Zoom"})},i)),l=this.props.scale&&this.props.scale<g.tR.MAX_SCALE?r().createElement("span",{className:"modal-zoom-btn"},r().createElement("a",{onClick:this.props.handleZoomIn&&ae()(this.props.handleZoomIn,300,{maxWait:300})},r().createElement("i",{className:"icon icon-plus"}))):r().createElement("span",{className:"btn-inactive"},r().createElement("i",{className:"icon icon-plus"})),e.push(r().createElement(U.A,{key:"zoomIn",title:r().createElement(m.FormattedMessage,{id:"view_image.zoom_in",defaultMessage:"Zoom In"})},l)),t=r().createElement("div",{className:"modal-column"},e)}return r().createElement("div",{"data-testid":"fileCountFooter",className:"modal-button-bar file-preview-modal__zoom-bar"},t)}}te=se,ie="propTypes",ne={scale:l().number,showZoomControls:l().bool,handleZoomIn:l().func,handleZoomOut:l().func,handleZoomReset:l().func},(ie=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(ie))in te?Object.defineProperty(te,ie,{value:ne,enumerable:!0,configurable:!0,writable:!0}):te[ie]=ne;const oe=se;function re(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function ce(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?re(Object(i),!0).forEach((function(t){me(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):re(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function me(e,t,i){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const de=r().lazy((()=>Promise.all([i.e(1959),i.e(5660)]).then(i.bind(i,25660)))),fe=g.Ay.KeyCodes;class ue extends r().PureComponent{constructor(e){super(e),me(this,"handleNext",(()=>{let e=this.state.imageIndex+1;e>this.props.fileInfos.length-1&&(e=0),this.showImage(e)})),me(this,"handlePrev",(()=>{let e=this.state.imageIndex-1;e<0&&(e=this.props.fileInfos.length-1),this.showImage(e)})),me(this,"handleKeyPress",(e=>{O.e(e,fe.RIGHT)?this.handleNext():O.e(e,fe.LEFT)&&this.handlePrev()})),me(this,"showImage",(e=>{this.setState({imageIndex:e});const t=window.innerHeight-100;this.setState({imageHeight:t}),this.state.loaded[e]||this.loadImage(e)})),me(this,"isImageUrl",(e=>{const t=x.ti(e);return t===g.a0.IMAGE||t===g.a0.SVG})),me(this,"getFileTypeFromFileInfo",(e=>{if(z(e))return x.ti(e.extension);if(V(e)){const t=11,i=e.extension&&e.extension.length<=t?e.extension:e.link;return x.ti(i)}return g.a0.OTHER})),me(this,"loadImage",(e=>{const t=this.props.fileInfos[e];if(z(t)&&t.archived)this.handleImageLoaded(e);else if(this.getFileTypeFromFileInfo(t)===g.a0.IMAGE){let i="";z(t)?i=t.has_preview_image?(0,d.cV)(t.id):(0,d.w8)(t.id):V(t)&&(i=t.link),x.yt(i,(()=>this.handleImageLoaded(e)),(t=>this.handleImageProgress(e,t)))}else this.handleImageLoaded(e)})),me(this,"handleImageLoaded",(e=>{this.setState((t=>({loaded:ce(ce({},t.loaded),{},{[e]:!0})})))})),me(this,"handleImageProgress",((e,t)=>{this.setState((i=>({progress:ce(ce({},i.progress),{},{[e]:t})})))})),me(this,"onMouseEnterImage",(()=>{this.setState({showCloseBtn:!0})})),me(this,"onMouseLeaveImage",(()=>{this.setState({showCloseBtn:!1})})),me(this,"setScale",((e,t)=>{this.setState((i=>({scale:ce(ce({},i.scale),{},{[e]:t})})))})),me(this,"handleZoomIn",(()=>{let e=this.state.scale[this.state.imageIndex];e=Math.min(e+g.tR.SCALE_DELTA,g.tR.MAX_SCALE),this.setScale(this.state.imageIndex,e)})),me(this,"handleZoomOut",(()=>{let e=this.state.scale[this.state.imageIndex];e=Math.max(e-g.tR.SCALE_DELTA,g.tR.MIN_SCALE),this.setScale(this.state.imageIndex,e)})),me(this,"handleZoomReset",(()=>{this.setScale(this.state.imageIndex,g.tR.DEFAULT_SCALE)})),me(this,"handleModalClose",(()=>{this.setState({show:!1})})),me(this,"getContent",(e=>{this.setState({content:e})})),me(this,"handleBgClose",(e=>{e.currentTarget===e.target&&this.handleModalClose()})),this.state={show:!0,imageIndex:this.props.startIndex,imageHeight:"100%",loaded:x.lI(!1,this.props.fileInfos.length),prevFileInfosCount:0,progress:x.lI(0,this.props.fileInfos.length),showCloseBtn:!1,showZoomControls:!1,scale:x.lI(g.tR.DEFAULT_SCALE,this.props.fileInfos.length),content:""}}componentDidMount(){document.addEventListener("keyup",this.handleKeyPress),this.showImage(this.props.startIndex)}componentWillUnmount(){document.removeEventListener("keyup",this.handleKeyPress)}static getDerivedStateFromProps(e,t){const i={};return e.fileInfos[t.imageIndex]&&e.fileInfos[t.imageIndex].extension===g.a0.PDF?i.showZoomControls=!0:i.showZoomControls=!1,e.fileInfos.length!==t.prevFileInfosCount&&(i.loaded=x.lI(!1,e.fileInfos.length),i.progress=x.lI(0,e.fileInfos.length),i.prevFileInfosCount=e.fileInfos.length),Object.keys(i).length?i:null}render(){var e;if(this.props.fileInfos.length<1||this.props.fileInfos.length-1<this.state.imageIndex)return null;const t=this.props.fileInfos[this.state.imageIndex],i=this.getFileTypeFromFileInfo(t);let n,l,a,o,f,p=!1;z(t)?(n=!0,l=t.name,a=(0,d.w8)(t.id),o=(0,d.S1)(t.id),f=!1):(n=!1,l=t.name||t.link,a=t.link,o=t.link,f=!0);let h,E,b="a11y__modal modal-image file-preview-modal";if(z(t)&&t.archived&&(h=r().createElement(u,{fileInfo:t})),!z(t)||!t.archived)if(this.state.loaded[this.state.imageIndex])i===g.a0.IMAGE||i===g.a0.SVG?h=r().createElement(ee,{fileInfo:t,canDownloadFiles:this.props.canDownloadFiles}):i===g.a0.VIDEO||i===g.a0.AUDIO?h=r().createElement(w,{fileInfo:t,fileUrl:a}):i===g.a0.PDF?(h=r().createElement("div",{className:"file-preview-modal__scrollable",onClick:this.handleBgClose},r().createElement(r().Suspense,{fallback:null},r().createElement(de,{fileInfo:t,fileUrl:a,scale:this.state.scale[this.state.imageIndex],handleBgClose:this.handleBgClose}))),E=r().createElement(oe,{scale:this.state.scale[this.state.imageIndex],showZoomControls:this.state.showZoomControls,handleZoomIn:this.handleZoomIn,handleZoomOut:this.handleZoomOut,handleZoomReset:this.handleZoomReset})):function(e){return Boolean(I.od(e.extension))}(t)?(b+=" modal-code",p=!0,h=r().createElement(M,{fileInfo:t,fileUrl:a,getContent:this.getContent,className:"file-preview-modal__code-preview"})):h=r().createElement(v.A,{fileInfo:t,fileUrl:a});else{const e=Math.floor(this.state.progress[this.state.imageIndex]);h=r().createElement(R.A,{loading:r().createElement(m.FormattedMessage,{id:"view_image.loading",defaultMessage:"Loading"}),progress:e})}if(z(t)&&!t.archived)for(const e of this.props.pluginFilePreviewComponents)if(e.override(t,this.props.post)){h=r().createElement(e.component,{fileInfo:t,post:this.props.post,onModalDismissed:this.handleModalClose});break}return r().createElement(c.Modal,{show:this.state.show,onHide:this.handleModalClose,onExited:this.props.onExited,className:"modal-image file-preview-modal",dialogClassName:b,animation:!0,backdrop:!1,role:"none",style:{paddingLeft:0},"aria-labelledby":"viewImageModalLabel"},r().createElement(c.Modal.Body,{className:"file-preview-modal__body"},r().createElement("div",{className:"modal-image__wrapper",onClick:this.handleModalClose},r().createElement("div",{className:"file-preview-modal__main-ctr",onMouseEnter:this.onMouseEnterImage,onMouseLeave:this.onMouseLeaveImage,onClick:e=>e.stopPropagation()},r().createElement(c.Modal.Title,{componentClass:"div",id:"viewImageModalLabel",className:"file-preview-modal__title"},r().createElement($,{isMobileView:this.props.isMobileView,post:this.props.post,showPublicLink:n,fileIndex:this.state.imageIndex,totalFiles:null===(e=this.props.fileInfos)||void 0===e?void 0:e.length,filename:l,fileURL:o,fileInfo:t,enablePublicLink:this.props.enablePublicLink,canDownloadFiles:this.props.canDownloadFiles,canCopyContent:p,isExternalFile:f,handlePrev:this.handlePrev,handleNext:this.handleNext,handleModalClose:this.handleModalClose,content:this.state.content}),E),r().createElement("div",{className:s()("file-preview-modal__content",{"file-preview-modal__content-scrollable":(!z(t)||!t.archived)&&this.state.loaded[this.state.imageIndex]&&i===g.a0.PDF}),onClick:this.handleBgClose},h),this.props.isMobileView&&r().createElement(X,{post:this.props.post,showPublicLink:n,filename:l,fileURL:o,fileInfo:t,enablePublicLink:this.props.enablePublicLink,canDownloadFiles:this.props.canDownloadFiles,canCopyContent:p,isExternalFile:f,handleModalClose:this.handleModalClose,content:this.state.content})))))}}me(ue,"propTypes",{canDownloadFiles:l().bool.isRequired,enablePublicLink:l().bool.isRequired,isMobileView:l().bool.isRequired,pluginFilePreviewComponents:l().array,onExited:l().func.isRequired,postId:l().string,startIndex:l().number}),me(ue,"defaultProps",{fileInfos:[],startIndex:0,pluginFilePreviewComponents:[]})}}]);
//# sourceMappingURL=11.68333efc85a27fd77434.js.map